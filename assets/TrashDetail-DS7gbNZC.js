import{n as I,p as z,r as x,q as C,l as k,_ as H,s as R,o as j,y as G,c as p,a as e,j as N,b as O,u as m,F as P,k as U,t as y,e as g,w as E,g as b,v as $,h as J,i as u,x as K,E as Q}from"./index-BeboNJFR.js";import{f as M,u as W}from"./notebooks-ahI-daUz.js";import{M as X}from"./index-BMSQkwth.js";const A={GET:"/notes/trash",REVERT:"/notes/:noteId/revert",DELETE:"/notes/:noteId/confirm"},D={async getAll(){const t=await I(A.GET);return t.data=t.data.map(o=>(o.createdAtFriendly=M(o.createdAt),o.updatedAtFriendly=M(o.updatedAt),o)).sort((o,i)=>new Date(i.updatedAt)-new Date(o.updatedAt)),t},deleteNote({noteId:t}){return I(A.DELETE.replace(":noteId",t),"DELETE")},revertNote({noteId:t}){return I(A.REVERT.replace(":noteId",t),"PATCH")}},Y=z("trash",()=>{const t=x([]),o=x(null),i=C(()=>o.value?t.value.find(s=>s.id==o.value)||{}:t.value[0]||{}),c=s=>{t.value=s};return{trashNotes:t,currTrashNote:i,currTrashNoteId:o,setTrashNotes:c,setCurrTrashNoteId:s=>{o.value=s},getTrashNotes:async()=>{const s=await D.getAll();c(s.data)},addTrashNote:s=>{t.value.unshift(s)},revertNote:async s=>{const h=await D.revertNote({noteId:s});t.value=t.value.filter(v=>v.id!==s),k({type:"success",message:h.msg})},deleteNote:async s=>{const h=await D.deleteNote({noteId:s});t.value=t.value.filter(v=>v.id!==s),k({type:"success",message:h.msg})}}}),Z={id:"trash",class:"detail"},ee={class:"note-sidebar"},te={class:"notes-wrapper"},se={key:1,class:"note-list"},ae={class:"note-title"},oe={class:"note-date"},re={class:"note-detail"},ne={key:0,class:"note-detail-ct"},le={class:"note-bar"},ie={class:"meta-info"},ce={class:"actions"},de={class:"note-title"},ue={class:"editor"},pe=["innerHTML"],he={key:1,class:"note-empty"},ve=Object.assign({name:"TrashDetail"},{__name:"TrashDetail",setup(t){const o=new X,i=$(),c=J(),d=Y(),{currTrashNote:n,trashNotes:l}=R(d),w=W(),{notebooks:T}=R(w),s=C(()=>o.render(n.value.content||"")),h=C(()=>{if(!n.value||!n.value.notebookId)return"未知笔记本";if(!T.value||T.value.length===0)return"加载中...";const a=T.value.find(r=>r.id==n.value.notebookId);return a?a.title:"未知笔记本"}),v=async()=>{try{if(await d.getTrashNotes(),await w.getNotebooks(),i.query.noteId)d.setCurrTrashNoteId(i.query.noteId);else if(l.value.length>0){const a=l.value[0].id;c.replace({path:"/trash",query:{noteId:a}})}}catch(a){console.error("加载回收站笔记失败:",a)}};j(()=>{v()}),G(()=>i.query.noteId,a=>{a&&d.setCurrTrashNoteId(a)},{immediate:!0});const B=(a,r)=>{const _=i.query.noteId;return _?_==a:r===0},L=async()=>{if(n.value?.id)try{await Q.confirm("彻底删除后将无法恢复，确定吗？","警示",{confirmButtonText:"彻底删除",cancelButtonText:"取消",type:"warning"}),await d.deleteNote(n.value.id),l.value.length>0?c.replace({path:"/trash",query:{noteId:l.value[0].id}}):c.replace({path:"/trash"})}catch(a){a!=="cancel"&&a!=="close"&&k.error("删除失败")}},F=async()=>{if(n.value?.id)try{await d.revertNote(n.value.id),l.value.length>0?c.replace({path:"/trash",query:{noteId:l.value[0].id}}):c.replace({path:"/trash"})}catch{k.error("恢复失败")}};return(a,r)=>{const _=b("el-empty"),S=b("router-link"),q=b("el-button");return u(),p("div",Z,[e("div",ee,[r[0]||(r[0]=e("div",{class:"sidebar-header"},[e("h3",{class:"notebook-title"},[e("i",{class:"iconfont icon-trash"}),N(" 回收站 ")])],-1)),e("div",te,[m(l).length===0?(u(),O(_,{key:0,description:"回收站是空的","image-size":60})):(u(),p("ul",se,[(u(!0),p(P,null,U(m(l),(f,V)=>(u(),p("li",{key:f.id},[g(S,{to:`/trash?noteId=${f.id}`,class:K(["note-item",{active:B(f.id,V)}])},{default:E(()=>[e("span",ae,y(f.title||"无标题笔记"),1),e("span",oe,y(f.updatedAtFriendly),1)]),_:2},1032,["to","class"])]))),128))]))])]),e("div",re,[m(n).id?(u(),p("div",ne,[e("div",le,[e("div",ie,[e("span",null,[r[1]||(r[1]=N("原属于: ",-1)),e("b",null,y(h.value),1)]),r[2]||(r[2]=e("span",{class:"divider"},"|",-1)),e("span",null,"删除时间: "+y(m(n).updatedAtFriendly),1)]),e("div",ce,[g(q,{type:"primary",size:"small",plain:"",onClick:F},{default:E(()=>[...r[3]||(r[3]=[e("i",{class:"iconfont icon-refresh"},null,-1),N(" 恢复笔记 ",-1)])]),_:1}),g(q,{type:"danger",size:"small",plain:"",onClick:L},{default:E(()=>[...r[4]||(r[4]=[e("i",{class:"iconfont icon-delete"},null,-1),N(" 彻底删除 ",-1)])]),_:1})])]),e("div",de,[e("span",null,y(m(n).title),1)]),e("div",ue,[e("div",{class:"preview markdown-body",innerHTML:s.value},null,8,pe)])])):(u(),p("div",he,[g(_,{description:"选择一条笔记查看详情"})]))])])}}}),ye=H(ve,[["__scopeId","data-v-ec452f73"]]);export{ye as default};
