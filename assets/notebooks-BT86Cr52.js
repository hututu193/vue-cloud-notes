import{n as d,p as A,r as b,q as y,l as f}from"./index-b4LvJrqS.js";function u(e){let r=(typeof e=="object"?e:new Date(e)).getTime(),s=Date.now()-r,n="";switch(!0){case s<6e4:n="刚刚";break;case s<1e3*3600:n=Math.floor(s/6e4)+"分钟前";break;case s<1e3*3600*24:n=Math.floor(s/(1e3*3600))+"小时前";break;default:n=Math.floor(s/(1e3*3600*24))+"天前"}return n}const l={GET:"/notebooks",ADD:"/notebooks",UPDATE:"/notebooks/:id",DELETE:"/notebooks/:id"},c={async getAll(){const e=await d(l.GET);return e.data.sort((t,r)=>t.createdAt<r.createdAt?1:-1),e.data.forEach(t=>{t.createdAtFriendly=u(t.createdAt),t.updatedAtFriendly=u(t.updatedAt)}),e},updateNotebook(e,{title:t=""}={title:""}){return d(l.UPDATE.replace(":id",e),"PATCH",{title:t})},deleteNotebook(e){return d(l.DELETE.replace(":id",e),"DELETE")},async addNotebook({title:e=""}={title:""}){const t=await d(l.ADD,"POST",{title:e});return t.data.createdAtFriendly=u(t.data.createdAt),t.data.updatedAtFriendly=u(t.data.updatedAt),t}},m=A("notebooks",()=>{const e=b([]),t=b(null),r=b(!1),i=y(()=>Array.isArray(e.value)?e.value.length===0?{}:t.value?e.value.find(a=>a.id==t.value)||e.value[0]||{}:e.value[0]||{}:{}),s=o=>{e.value=o};return{notebooks:e,currentBookId:t,currentBook:i,isLoaded:r,setNotebooks:s,addNotebook:async o=>{const a=await c.addNotebook({title:o});e.value.unshift(a.data),f({type:"success",message:a.msg})},updateNotebook:async(o,a)=>{const k=await c.updateNotebook(o,{title:a}),p=e.value.find(v=>v.id===o);p&&(p.title=a),f({type:"success",message:k.msg})},deleteNotebook:async o=>{const a=await c.deleteNotebook(o);e.value=e.value.filter(k=>k.id!==o),f({type:"success",message:a.msg})},getNotebooks:async(o=!1)=>{if(r.value&&!o)return{data:e.value};const a=await c.getAll();return s(a.data),r.value=!0,a},setCurrentBookId:o=>{t.value=o},reset:()=>{e.value=[],i.value=null,r.value=!1}}});export{u as f,m as u};
